# æš´åŠ›ç©·ä¸¾ç»„åˆå›æµ‹æŒ‡å—

å°†æ‰€æœ‰æ¨¡å‹çš„é¢„æµ‹è¿›è¡Œæš´åŠ›ç»„åˆç©·ä¸¾ï¼Œå¯¹æ¯ä¸ªç»„åˆåšç­‰æƒèåˆå›æµ‹ï¼Œæ‰¾åˆ°æœ€ä¼˜æ¨¡å‹ç»„åˆã€‚

## å¿«é€Ÿå¼€å§‹

```bash
cd /path/to/QuantPits

# å¿«é€Ÿæµ‹è¯•ï¼ˆæœ€å¤š 3 ä¸ªæ¨¡å‹çš„ç»„åˆï¼Œçº¦ 175 æ¬¡å›æµ‹ï¼‰
python quantpits/scripts/brute_force_ensemble.py --max-combo-size 3

# å®Œæ•´ç©·ä¸¾ï¼ˆ10 ä¸ªæ¨¡å‹ = 1023 ä¸ªç»„åˆï¼Œè€—æ—¶è¾ƒé•¿ï¼‰
python quantpits/scripts/brute_force_ensemble.py

# ä»…åˆ†æå·²æœ‰ç»“æœï¼ˆä¸é‡æ–°è·‘å›æµ‹ï¼‰
python quantpits/scripts/brute_force_ensemble.py --analysis-only

# ä»ä¸Šæ¬¡ä¸­æ–­å¤„ç»§ç»­ï¼ˆCtrl+C ä¸­æ–­æˆ–å´©æºƒåå‡å¯ï¼‰
python quantpits/scripts/brute_force_ensemble.py --resume

# ä½¿ç”¨æ¨¡å‹åˆ†ç»„ç©·ä¸¾ï¼ˆæ¯ç»„åªé€‰ä¸€ä¸ªï¼Œå¤§å¹…å‡å°‘ç»„åˆæ•°ï¼‰
python quantpits/scripts/brute_force_ensemble.py --use-groups

# æŒ‡å®šè‡ªå®šä¹‰åˆ†ç»„ + å‡å°‘çº¿ç¨‹æ•°æ§åˆ¶å†…å­˜
python quantpits/scripts/brute_force_ensemble.py --use-groups --group-config config/my_groups.yaml --n-jobs 2
```

## è„šæœ¬æµç¨‹

### Stage 1 â€” åŠ è½½é¢„æµ‹æ•°æ®
- è¯»å– `latest_train_records.json` è·å–å®éªŒåå’Œæ¨¡å‹åˆ—è¡¨
- ä» Qlib Recorder åŠ è½½æ¯ä¸ªæ¨¡å‹çš„ `pred.pkl` é¢„æµ‹å€¼
- æŒ‰å¤©åš Z-Score å½’ä¸€åŒ–

### Stage 2 â€” ç›¸å…³æ€§åˆ†æ
- è®¡ç®—é¢„æµ‹å€¼ç›¸å…³æ€§çŸ©é˜µ
- ä¿å­˜ CSV ä¾›åç»­åˆ†æ

### Stage 3 â€” æš´åŠ›ç©·ä¸¾å›æµ‹
- ç”Ÿæˆæ‰€æœ‰æ¨¡å‹ç»„åˆï¼ˆä» 1 ä¸ªåˆ° N ä¸ªï¼‰
- å¯¹æ¯ä¸ªç»„åˆï¼šç­‰æƒèåˆ â†’ TopkDropoutStrategy â†’ Qlib å›æµ‹
- æå–æŒ‡æ ‡ï¼šå¹´åŒ–æ”¶ç›Šã€æœ€å¤§å›æ’¤ã€Calmarã€è¶…é¢æ”¶ç›Šç­‰
- æ”¯æŒ `--resume` ä»å·²æœ‰ CSV ç»§ç»­

### Stage 4 â€” ç»“æœåˆ†æ
- **Top ç»„åˆå±•ç¤º**ï¼šæŒ‰å¹´åŒ–è¶…é¢æ’åº Top 20ã€æœ€ç¨³å¥ Top 10
- **æ¨¡å‹å½’å› **ï¼šç»Ÿè®¡ Top/Bottom N ä¸­å„æ¨¡å‹å‡ºç°é¢‘ç‡ï¼Œè®¡ç®—å‡€èƒœåˆ†
- **ç›¸å…³æ€§ vs ç»©æ•ˆ**ï¼šè®¡ç®—å¤šæ ·æ€§çº¢åˆ©ï¼Œæ‰¾ä½ç›¸å…³æ€§é«˜ Calmar çš„"é»„é‡‘ç»„åˆ"
- **å±‚æ¬¡èšç±»**ï¼šåŸºäºè¶…é¢æ”¶ç›Šç›¸å…³æ€§åš Ward èšç±»
- **æƒé‡ä¼˜åŒ–**ï¼šå¯¹ Top 10 å•æ¨¡å‹åš Max Sharpe / Risk Parity ä¼˜åŒ–å¯¹æ¯”
- **ç»¼åˆæŠ¥å‘Š**ï¼šè‡ªåŠ¨è¾“å‡ºæœ€ä½³ç»„åˆã€MVP æ ¸å¿ƒæ¨¡å‹

## å®Œæ•´å‚æ•°åˆ—è¡¨

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--record-file` | `latest_train_records.json` | è®­ç»ƒè®°å½•æ–‡ä»¶ |
| `--max-combo-size` | `0` (å…¨éƒ¨) | æœ€å¤§ç»„åˆæ¨¡å‹æ•°ï¼ˆåˆ†ç»„æ¨¡å¼ä¸‹æŒ‡é€‰å‡ ä¸ªç»„ï¼‰ |
| `--min-combo-size` | `1` | æœ€å°ç»„åˆæ¨¡å‹æ•°ï¼ˆåˆ†ç»„æ¨¡å¼ä¸‹æŒ‡é€‰å‡ ä¸ªç»„ï¼‰ |
| `--freq` | `None` | å›æµ‹äº¤æ˜“é¢‘ç‡ (`day` / `week`)ï¼Œé»˜è®¤ä» `model_config.json` è¯»å– |
| `--top-n` | `50` | åˆ†ææ—¶ Top/Bottom N |
| `--output-dir` | `output/brute_force` | è¾“å‡ºç›®å½• |
| `--resume` | - | ä»å·²æœ‰ CSV ç»§ç»­ï¼ˆæ”¯æŒå´©æºƒ/ä¸­æ–­åæ¢å¤ï¼‰ |
| `--skip-analysis` | - | è·³è¿‡åˆ†æé˜¶æ®µ |
| `--analysis-only` | - | ä»…åˆ†æå·²æœ‰ç»“æœ |
| `--n-jobs` | `4` | å¹¶å‘å›æµ‹çº¿ç¨‹æ•° |
| `--batch-size` | `50` | æ¯æ‰¹å¤„ç†ç»„åˆæ•°ï¼ˆå½±å“ checkpoint ç²’åº¦å’Œå†…å­˜ï¼‰ |
| `--use-groups` | - | å¯ç”¨åˆ†ç»„ç©·ä¸¾æ¨¡å¼ï¼ˆæ¯ç»„åªé€‰ä¸€ä¸ªæ¨¡å‹ï¼‰ |
| `--group-config` | `config/combo_groups.yaml` | åˆ†ç»„é…ç½®æ–‡ä»¶è·¯å¾„ |

## è¾“å‡ºæ–‡ä»¶

æ‰€æœ‰è¾“å‡ºä¿å­˜åœ¨ `output/brute_force/` ç›®å½•ä¸‹ï¼š

```
output/brute_force/
â”œâ”€â”€ correlation_matrix_{date}.csv     # é¢„æµ‹å€¼ç›¸å…³æ€§çŸ©é˜µ
â”œâ”€â”€ brute_force_results_{date}.csv    # å›æµ‹ç»“æœï¼ˆæ ¸å¿ƒæ–‡ä»¶ï¼‰
â”œâ”€â”€ model_attribution_{date}.csv      # æ¨¡å‹å½’å› è¡¨
â”œâ”€â”€ model_attribution_{date}.png      # å½’å› æ¡å½¢å›¾
â”œâ”€â”€ risk_return_scatter_{date}.png    # é£é™©-æ”¶ç›Šæ•£ç‚¹å›¾
â”œâ”€â”€ cluster_dendrogram_{date}.png     # å±‚æ¬¡èšç±»å›¾
â”œâ”€â”€ optimization_weights_{date}.csv   # ä¼˜åŒ–æƒé‡
â”œâ”€â”€ optimization_equity_{date}.png    # ä¼˜åŒ–ç­–ç•¥å‡€å€¼æ›²çº¿
â””â”€â”€ analysis_report_{date}.txt        # ç»¼åˆåˆ†ææŠ¥å‘Š
```

## è¿è¡Œæ—¶é—´ä¼°è®¡

ä»¥ 10 ä¸ªæ¨¡å‹ä¸ºä¾‹ï¼ˆå…± 1023 ä¸ªç»„åˆï¼‰ï¼š

| æ¨¡å‹ç»„åˆå¤§å° | ç»„åˆæ•°é‡ | é¢„ä¼°è€—æ—¶ |
|:---:|:---:|:---:|
| 1~3 | 175 | ~15 åˆ†é’Ÿ |
| 1~5 | 637 | ~50 åˆ†é’Ÿ |
| 1~10 (å…¨éƒ¨) | 1023 | ~1.5 å°æ—¶ |

> **å»ºè®®**ï¼šé¦–æ¬¡ä½¿ç”¨ `--max-combo-size 3` å¿«é€ŸéªŒè¯ï¼Œç¡®è®¤æ— è¯¯åå†è·‘å®Œæ•´ç©·ä¸¾ã€‚

## è¿›é˜¶ç”¨æ³•

### ä»…çœ‹ç‰¹å®šå¤§å°çš„ç»„åˆ
```bash
# åªçœ‹ 4-6 ä¸ªæ¨¡å‹çš„ç»„åˆ
python quantpits/scripts/brute_force_ensemble.py --min-combo-size 4 --max-combo-size 6
```

### æ—¥é¢‘å›æµ‹
```bash
python quantpits/scripts/brute_force_ensemble.py --freq day
```

### æ›´ç»†ç²’åº¦çš„å½’å› åˆ†æ
```bash
# Top/Bottom 100 çš„å½’å› 
python quantpits/scripts/brute_force_ensemble.py --analysis-only --top-n 100
```

## æ–­ç‚¹ç»­è·‘ä¸å®‰å…¨ä¸­æ–­

è„šæœ¬æ”¯æŒ **å¢é‡ checkpoint** å’Œ **ä¿¡å·å®‰å…¨ä¸­æ–­**ï¼Œç¡®ä¿é•¿æ—¶é—´ç©·ä¸¾ä»»åŠ¡ä¸ä¼šä¸¢å¤±è¿›åº¦ã€‚

### å·¥ä½œåŸç†

- **åˆ†æ‰¹æ‰§è¡Œ**ï¼šå°†æ‰€æœ‰ç»„åˆåˆ†ä¸º `--batch-size` å¤§å°çš„æ‰¹æ¬¡ï¼Œæ¯æ‰¹å®Œæˆåç«‹åˆ»è¿½åŠ å†™å…¥ CSV
- **ä¿¡å·å¤„ç†**ï¼šæ³¨å†Œ `SIGINT` (Ctrl+C) / `SIGTERM` handlerï¼Œæ”¶åˆ°ä¿¡å·åï¼š
  1. ç­‰å¾…å½“å‰æ‰¹æ¬¡ä¸­å·²æäº¤çš„å›æµ‹ä»»åŠ¡å®Œæˆ
  2. å°†å·²å®Œæˆçš„ç»“æœä¿å­˜åˆ° CSV
  3. æ‰“å°ä¸­æ–­æç¤ºå¹¶å®‰å…¨é€€å‡º
  4. å†æ¬¡æŒ‰ Ctrl+C å¯å¼ºåˆ¶é€€å‡º
- **Resume**ï¼š`--resume` è¯»å–å·²æœ‰ CSV è‡ªåŠ¨è·³è¿‡å·²å®Œæˆç»„åˆ

### ä½¿ç”¨æ–¹å¼

```bash
# å¯åŠ¨ç©·ä¸¾
python quantpits/scripts/brute_force_ensemble.py --max-combo-size 5

# è¿è¡Œä¸­æŒ‰ Ctrl+C â†’ å½“å‰æ‰¹æ¬¡å®Œæˆåå®‰å…¨é€€å‡º
# è¾“å‡º: "âš ï¸ å·²å®‰å…¨ä¸­æ–­ï¼å·²å®Œæˆ: X/Y ç»„åˆï¼Œä½¿ç”¨ --resume ç»§ç»­"

# ä»ä¸­æ–­å¤„ç»§ç»­
python quantpits/scripts/brute_force_ensemble.py --max-combo-size 5 --resume
```

### å†…å­˜æ§åˆ¶

| å‚æ•° | ä½œç”¨ |
|------|------|
| `--batch-size` | å‡å°æ‰¹æ¬¡å¤§å°å¯é™ä½å†…å­˜å³°å€¼ï¼ˆé»˜è®¤ 50ï¼‰ |
| `--n-jobs` | å‡å°‘çº¿ç¨‹æ•°å¯é™ä½å¹¶å‘å†…å­˜å ç”¨ï¼ˆå»ºè®® 2-4ï¼‰ |

> æ¯ä¸ªæ‰¹æ¬¡å®Œæˆåä¼šè‡ªåŠ¨è°ƒç”¨ `gc.collect()` é‡Šæ”¾ä¸­é—´å¯¹è±¡ã€‚

---

## æ¨¡å‹åˆ†ç»„ç©·ä¸¾

å½“æ¨¡å‹æ•°è¾ƒå¤šæ—¶ï¼ˆ15+ ä¸ªï¼‰ï¼Œå…¨ç©·ä¸¾çš„ç»„åˆæ•°çˆ†ç‚¸ï¼ˆ32767+ï¼‰ã€‚åˆ†ç»„ç©·ä¸¾æ¨¡å¼å°†æ¨¡å‹æŒ‰**äººå·¥å®šä¹‰çš„ç»„åˆ«**åˆ†ç»„ï¼Œæ¯ç»„åªé€‰ä¸€ä¸ªæ¨¡å‹å‚ä¸ç»„åˆï¼Œå¤§å¹…å‡å°‘æœ‰æ•ˆç»„åˆæ•°ã€‚

### é…ç½®æ–‡ä»¶

åˆ†ç»„é…ç½®åœ¨ `config/combo_groups.yaml`ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```yaml
groups:
  LSTM_variants:           # ç»„åï¼ˆè‡ªå®šä¹‰ï¼‰
    - lstm_Alpha360        # ç»„å†…æ¨¡å‹ï¼ˆä¸ train_records ä¸­çš„ key ä¸€è‡´ï¼‰
    - alstm_Alpha158
    - alstm_Alpha360

  Tree_models:
    - lightgbm_Alpha158
    - catboost_Alpha158

  # ... æ›´å¤šç»„ ...
```

**è§„åˆ™**ï¼š
- ç»„åè‡ªå®šä¹‰ï¼Œä»…ç”¨äºå±•ç¤º
- å¼€å¯åˆ†ç»„æ¨¡å¼æ—¶ï¼Œ**æœªå‡ºç°åœ¨ä»»ä½•ç»„ä¸­çš„æ¨¡å‹å°†è¢«æ’é™¤**ï¼ˆä¸è‡ªåŠ¨å‚ä¸ï¼‰
- æ­¤æ–‡ä»¶ä¸ `model_registry.yaml` å®Œå…¨ç‹¬ç«‹ï¼Œä¸è‡ªåŠ¨å…³è” tags
- `--min/max-combo-size` åœ¨åˆ†ç»„æ¨¡å¼ä¸‹æ§åˆ¶**é€‰å‡ ä¸ªç»„å‚ä¸**

### ä½¿ç”¨æ–¹å¼

```bash
# ä½¿ç”¨é»˜è®¤åˆ†ç»„é…ç½®
python quantpits/scripts/brute_force_ensemble.py --use-groups

# æŒ‡å®šè‡ªå®šä¹‰åˆ†ç»„
python quantpits/scripts/brute_force_ensemble.py --use-groups --group-config config/custom_groups.yaml

# åˆ†ç»„ + åªçœ‹ 3~4 ä¸ªç»„çš„ç»„åˆ
python quantpits/scripts/brute_force_ensemble.py --use-groups --min-combo-size 3 --max-combo-size 4
```

### ç»„åˆæ•°å¯¹æ¯”ç¤ºä¾‹

| åœºæ™¯ | æ¨¡å‹æ•° | å…¨ç©·ä¸¾ç»„åˆæ•° | åˆ†ç»„ç©·ä¸¾ç»„åˆæ•° |
|:---:|:---:|:---:|:---:|
| 15 ä¸ªæ¨¡å‹, 6 ç»„ Ã— 2~3 ä¸ª | 15 | 32767 | ~500 |
| 10 ä¸ªæ¨¡å‹, 5 ç»„ Ã— 2 ä¸ª | 10 | 1023 | ~62 |

> **æç¤º**ï¼š`brute_force_fast.py` (å¿«é€Ÿæ¨¡å¼) ä¹Ÿå®Œå…¨æ”¯æŒä¸Šè¿° `--use-groups` å’Œ `--group-config` åˆ†ç»„ç©·ä¸¾åŠŸèƒ½ï¼Œç”¨æ³•ä¸€è‡´ã€‚

---

## âš¡ å¿«é€Ÿæ¨¡å¼ (`brute_force_fast.py`)

å½“æ¨¡å‹æ•°é‡è¾ƒå¤šï¼ˆ>10ï¼‰ã€ç»„åˆæ•°é‡å·¨å¤§æ—¶ï¼ŒåŸç‰ˆ qlib å›æµ‹éå¸¸æ…¢ã€‚`brute_force_fast.py` ä½¿ç”¨ **NumPy/CuPy å‘é‡åŒ–çŸ©é˜µè¿ç®—** æ›¿ä»£ qlib çš„é€å•æ¨¡æ‹Ÿï¼Œé€Ÿåº¦æå‡ **~5000 å€**ã€‚

### å¿«é€Ÿå¼€å§‹

```bash
cd /path/to/QuantPits

# å¿«é€Ÿæµ‹è¯•
python quantpits/scripts/brute_force_fast.py --max-combo-size 3

# å®Œæ•´ç©·ä¸¾
python quantpits/scripts/brute_force_fast.py

# ================================
# é˜²æ­¢è¿‡æ‹Ÿåˆçš„é«˜é˜¶æŒ‰æ—¶é—´çª—å£æµ‹è¯• (æ¨è!)
# åœ¨é™¤æœ€å 1 å¹´å¤–çš„æ‰€æœ‰æ•°æ®ä¸Šå¯»æ‰¾æœ€ä½³ç»„åˆ (In-Sample)
# å¹¶åœ¨æœ€å 1 å¹´çš„æ•°æ®ä¸Šè‡ªåŠ¨éªŒè¯å‰ 10 åç»„åˆ (Out-Of-Sample)
# ================================
python quantpits/scripts/brute_force_fast.py --exclude-last-years 1 --auto-test-top 10

# ä½¿ç”¨ GPU åŠ é€Ÿ
python quantpits/scripts/brute_force_fast.py --use-gpu

# ä»…åˆ†æå·²æœ‰ç»“æœ
python quantpits/scripts/brute_force_fast.py --analysis-only

# ä»ä¸Šæ¬¡ä¸­æ–­å¤„ç»§ç»­
python quantpits/scripts/brute_force_fast.py --resume

# ä½¿ç”¨æ¨¡å‹åˆ†ç»„ç©·ä¸¾åŠ é€Ÿæµ‹è¯•
python quantpits/scripts/brute_force_fast.py --use-groups --group-config config/combo_groups_20.yaml
```

### ç²¾åº¦å·®å¼‚

| ç‰¹æ€§ | åŸç‰ˆ (qlib backtest) | å¿«é€Ÿç‰ˆ (vectorized) |
|------|:---:|:---:|
| æ¶¨è·Œåœè¿‡æ»¤ | âœ… | âŒ |
| äº¤æ˜“è´¹ç”¨ | âœ… ç²¾ç¡®  | âš ï¸ æŒ‰æ¢æ‰‹ç‡ä¼°ç®— |
| TopK+Dropout | âœ… å®Œæ•´ | âš ï¸ ä»… TopK |
| èµ„é‡‘ç®¡ç† | âœ… å®Œæ•´ | âŒ å‡è®¾å…¨ä»“ç­‰æƒ |
| é€Ÿåº¦ | ~5s/combo | ~0.001s/combo |

> **æ³¨æ„ç²¾åº¦å·®å¼‚**ï¼šå¿«é€Ÿç‰ˆï¼ˆfastï¼‰å’Œæ­£å¼ç©·ä¸¾ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼ˆå› ä¸º fast æ— æ³•é¡ºåˆ©å¤„ç†æŒä»“ï¼Œå¯¹äºéå…¨ä»“äº¤æ¢çš„ä¼šæœ‰å¾ˆå¤§è¯¯å·®ï¼‰ã€‚è¯·è°¨æ…ä½¿ç”¨ã€‚

### æ¨èå·¥ä½œæµ

1. **ç²—ç­›**ï¼š`python quantpits/scripts/brute_force_fast.py` è·‘å®Œæ‰€æœ‰ç»„åˆï¼ˆåˆ†é’Ÿçº§ï¼‰
2. **ç²¾ç¡®éªŒè¯**ï¼šå°†å¿«é€Ÿç‰ˆ Top 10-20 ç»„åˆï¼Œç”¨åŸç‰ˆ `brute_force_ensemble.py` ç²¾ç¡®å›æµ‹
3. **èåˆ**ï¼šé€‰å®šç»„åˆåç”¨ `ensemble_fusion.py` è¿›è¡Œæ­£å¼èåˆ

### å¿«é€Ÿç‰ˆä¸“æœ‰å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--batch-size` | `512` | æ‰¹é‡å¤„ç†å¤§å° |
| `--use-gpu` | - | å¼ºåˆ¶ä½¿ç”¨ GPU (éœ€è¦ CuPy) |
| `--no-gpu` | - | å¼ºåˆ¶ç¦ç”¨ GPU |
| `--cost-rate` | `0.002` | å•æ¬¡æ¢æ‰‹äº¤æ˜“è´¹ç”¨ç‡ (åŒè¾¹ 0.2%) |

> å…¶ä»–å‚æ•°ï¼ˆ`--max-combo-size`, `--resume`, `--analysis-only`, `--use-groups`, `--group-config`, `--exclude-last-years`, `--auto-test-top` ç­‰ï¼‰ä¸åŸç‰ˆç›¸åŒã€‚

---

## ğŸ•°ï¸ é«˜çº§æŠ€å·§ï¼šé˜²æ­¢ In-Sample è¿‡æ‹Ÿåˆ

åœ¨æœºå™¨å¯»æ‰¾æœ€ä½³ç»„åˆæ—¶ï¼Œæå…¶å®¹æ˜“å‡ºç° **In-Sample è¿‡æ‹Ÿåˆ** (é€‰å‡ºçš„ç»„åˆåˆšå¥½é€‚åº”äº†å½“å‰æ•´ä¸ªå›æµ‹æœŸï¼Œæœªæ¥è¡¨ç°æ‹‰èƒ¯)ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ`brute_force_ensemble.py` å’Œ `brute_force_fast.py` æ”¯æŒ**åŠ¨æ€ç›¸å¯¹æ—¶é—´çª—å£åˆ‡åˆ†**ï¼Œå…è®¸å°†æœ€æ–°çš„é¢„æµ‹æ•°æ®ç•™ä½œ **Out-Of-Sample (OOS) æµ‹è¯•é›†**ï¼š

### OOS éªŒè¯å·¥ä½œæµ

```bash
# 1. å¯»æ‰¾ç»„åˆå¹¶ç«‹å³åœ¨ OOS æ•°æ®ä¸ŠéªŒè¯
# --exclude-last-years 1: æŠŠæœ€è¿‘çš„ 1 å¹´æ•°æ®å‰”é™¤ï¼Œä»…ä½¿ç”¨å‰ 2 å¹´ä½œä¸º In-Sample å¯»æ‰¾ç»„åˆ
# --auto-test-top 5: åœ¨è¢«å‰”é™¤çš„æœ€è¿‘ 1 å¹´æ•°æ®ä¸Šï¼ŒéªŒè¯é€‰å‡ºçš„ Top 5 ç»„åˆ
python quantpits/scripts/brute_force_fast.py --exclude-last-years 1 --auto-test-top 5
```

æ‰§è¡Œåï¼Œé™¤äº†ç”Ÿæˆæ­£å¸¸çš„ IS æŠ¥å‘Šå¤–ï¼Œè¿˜ä¼šåœ¨ç»ˆç«¯è¾“å‡º `Stage 5: è‡ªåŠ¨ Out-Of-Sample (OOS) éªŒè¯ (Top 5)`ï¼Œå±•ç¤ºè¿™å‡ ä¸ªæœ€ä½³ç»„åˆåœ¨ä»æœªè§è¿‡çš„æ–°æ•°æ®ä¸Šçš„çœŸå®è¡¨ç°ã€‚

### æ—¥æœŸå‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ |
|------|------|
| `--exclude-last-years N` | åœ¨å¯»æ‰¾ç»„åˆæ—¶ï¼Œå‰”é™¤æœ€è¿‘ N å¹´çš„æ•°æ®ä½œä¸º OOS é›†ã€‚ |
| `--exclude-last-months N` | åŒä¸Šï¼Œå‰”é™¤æœ€è¿‘ N ä¸ªæœˆçš„æ•°æ®ã€‚ |
| `--auto-test-top N` | é€‰æ‹© Top N åœ¨ OOS é›†ä¸Šæ‰§è¡ŒçœŸå®å›æµ‹å¹¶ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š (`oos_validation_{date}.csv`)ã€‚|
| `--start-date YYYY-MM-DD` | ç»å¯¹æ—¥æœŸè¿‡æ»¤ï¼šå¼ºè¡ŒæŒ‡å®š IS é˜¶æ®µçš„æœ€æ—©å¼€å§‹æ—¥æœŸã€‚ |
| `--end-date YYYY-MM-DD` | ç»å¯¹æ—¥æœŸè¿‡æ»¤ï¼šå¼ºè¡Œæˆªæ–­ï¼Œå³ä¸ä½¿ç”¨è¯¥æ—¥æœŸä¹‹åçš„æ•°æ®ã€‚ |

> æ³¨ï¼šå› ä¸ºé¢„æµ‹æ•°æ®æ˜¯éšæ—¶é—´æ»šåŠ¨ï¼ˆæŒ‰äº¤æ˜“é¢‘æ¬¡æ–°å¢ï¼‰çš„ï¼Œæ¨èä½¿ç”¨ `exclude-last-years` æˆ– `exclude-last-months` åŠ¨æ€ä¿æŒå§‹ç»ˆå‰¥ç¦»æœ€æ–°çš„æ ·æœ¬ï¼Œé¿å…æ¯æ¬¡æ‰‹åŠ¨ä¿®æ”¹ç»å¯¹æ—¥æœŸã€‚

---

### GPU åŠ é€Ÿ

å®‰è£… CuPy å³å¯å¯ç”¨ GPU åŠ é€Ÿï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰ï¼š

```bash
# CUDA 12.x
pip install cupy-cuda11x # æˆ–è€…å®‰è£… cupy-cuda12xï¼Œå–å†³äºä½ çš„ CUDA ç‰ˆæœ¬

# CUDA 11.x
pip install cupy-cuda11x
```

### è¿è¡Œæ—¶é—´ä¼°è®¡ (å¿«é€Ÿæ¨¡å¼)

| æ¨¡å‹ç»„åˆå¤§å° | ç»„åˆæ•°é‡ | CPU é¢„ä¼°è€—æ—¶ | GPU é¢„ä¼°è€—æ—¶ |
|:---:|:---:|:---:|:---:|
| 1~3 | 175 | ~2 ç§’ | ~1 ç§’ |
| 1~5 | 637 | ~5 ç§’ | ~2 ç§’ |
| 1~10 (å…¨éƒ¨) | 1023 | ~10 ç§’ | ~3 ç§’ |
| 1~15 | 32767 | ~5 åˆ†é’Ÿ | ~1 åˆ†é’Ÿ |

### è¾“å‡ºæ–‡ä»¶

è¾“å‡ºä¿å­˜åœ¨ `output/brute_force_fast/`ï¼ˆä¸åŸç‰ˆç›®å½•åˆ†å¼€ï¼‰ï¼š

```
output/brute_force_fast/
â”œâ”€â”€ correlation_matrix_{date}.csv          # é¢„æµ‹å€¼ç›¸å…³æ€§çŸ©é˜µ
â”œâ”€â”€ brute_force_fast_results_{date}.csv    # å›æµ‹ç»“æœï¼ˆæ ¸å¿ƒæ–‡ä»¶ï¼‰
â”œâ”€â”€ model_attribution_{date}.csv           # æ¨¡å‹å½’å› è¡¨
â”œâ”€â”€ model_attribution_{date}.png           # å½’å› æ¡å½¢å›¾
â”œâ”€â”€ risk_return_scatter_{date}.png         # é£é™©-æ”¶ç›Šæ•£ç‚¹å›¾
â”œâ”€â”€ optimization_weights_{date}.csv        # ä¼˜åŒ–æƒé‡
â””â”€â”€ analysis_report_fast_{date}.txt        # ç»¼åˆåˆ†ææŠ¥å‘Š
```
